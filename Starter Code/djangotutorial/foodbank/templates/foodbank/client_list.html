{% extends 'foodbank/base.html' %}

{% block title %}Clients - Food Bank Management{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2>Client List</h2>
        <a href="{% url 'foodbank:client_intake' %}" class="btn">New Client Intake</a>
    </div>
    
    <form method="get" style="margin-bottom: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
        <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
            <input type="text" name="search" placeholder="Search by name, city, or zip..." value="{{ search_query }}" style="margin-bottom: 0;">
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <select name="status" style="margin-bottom: 0;">
                <option value="">All Statuses</option>
                <option value="eligible" {% if status_filter == 'eligible' %}selected{% endif %}>Eligible</option>
                <option value="not_eligible" {% if status_filter == 'not_eligible' %}selected{% endif %}>Not Eligible</option>
                <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending</option>
            </select>
        </div>
        <button type="submit" class="btn">Search</button>
        {% if search_query or status_filter %}
        <a href="{% url 'foodbank:client_list' %}" class="btn btn-secondary">Clear</a>
        {% endif %}
    </form>
    
    {% if clients %}
    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>City</th>
                <th>Household Size</th>
                <th>Monthly Income</th>
                <th>Eligibility</th>
                <th>Visits</th>
                <th>Last Visit</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for client in clients %}
            <tr>
                <td><strong>{{ client.first_name }} {{ client.last_name }}</strong></td>
                <td>{{ client.city }}, {{ client.state }}</td>
                <td>{{ client.household_size }}</td>
                <td>${{ client.monthly_income|floatformat:2 }}</td>
                <td>
                    <span class="badge badge-{{ client.eligibility_status }}">
                        {{ client.get_eligibility_status_display }}
                    </span>
                </td>
                <td>{{ client.visit_count }}</td>
                <td>{% if client.last_visit_date %}{{ client.last_visit_date|date:"M d, Y" }}{% else %}Never{% endif %}</td>
                <td>
                    <a href="{% url 'foodbank:client_detail' client.id %}" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem;">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No clients found. <a href="{% url 'foodbank:client_intake' %}">Register a new client</a>.</p>
    {% endif %}
</div>
{% endblock %}
